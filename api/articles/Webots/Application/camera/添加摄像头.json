{"title":"添加摄像头","uid":"c9ce92de968e539fb260956b4d902ffd","slug":"Webots/Application/camera/添加摄像头","date":"2022-01-30T12:49:36.000Z","updated":"2022-02-08T16:54:10.437Z","comments":true,"path":"api/articles/Webots/Application/camera/添加摄像头.json","keywords":null,"cover":"https://s2.loli.net/2022/02/09/kuC42m1ySOQohY7.jpg","content":"<h1 id=\"1-添加camera实体\"><a href=\"#1-添加camera实体\" class=\"headerlink\" title=\"1.添加camera实体\"></a><strong>1.添加camera实体</strong></h1><p>在Robot中添加 camera（camera相机）</p>\n<p><img src=\"https://img-blog.csdnimg.cn/20200425214446915.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NycDk5NzU3NjI4MA==,size_16,color_FFFFFF,t_70#pic_center\" alt=\"https://img-blog.csdnimg.cn/20200425214446915.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NycDk5NzU3NjI4MA==,size_16,color_FFFFFF,t_70#pic_center\"></p>\n<p><img src=\"https://img-blog.csdnimg.cn/20200425214520659.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NycDk5NzU3NjI4MA==,size_16,color_FFFFFF,t_70#pic_center\" alt=\"https://img-blog.csdnimg.cn/20200425214520659.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NycDk5NzU3NjI4MA==,size_16,color_FFFFFF,t_70#pic_center\"></p>\n<p>设置这个 camera 相机的children中添加 transform 节点，</p>\n<p><img src=\"https://img-blog.csdnimg.cn/20200426083131871.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NycDk5NzU3NjI4MA==,size_16,color_FFFFFF,t_70#pic_center\" alt=\"https://img-blog.csdnimg.cn/20200426083131871.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NycDk5NzU3NjI4MA==,size_16,color_FFFFFF,t_70#pic_center\"></p>\n<p>设置这个 transform 节点的children中添加shape节点，并设置外观和形状。设置半径 0.01 高度0.02</p>\n<p><img src=\"https://img-blog.csdnimg.cn/20200426083131939.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NycDk5NzU3NjI4MA==,size_16,color_FFFFFF,t_70#pic_center\" alt=\"https://img-blog.csdnimg.cn/20200426083131939.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NycDk5NzU3NjI4MA==,size_16,color_FFFFFF,t_70#pic_center\"></p>\n<p><img src=\"https://img-blog.csdnimg.cn/20200426083131875.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NycDk5NzU3NjI4MA==,size_16,color_FFFFFF,t_70#pic_center\" alt=\"https://img-blog.csdnimg.cn/20200426083131875.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NycDk5NzU3NjI4MA==,size_16,color_FFFFFF,t_70#pic_center\"></p>\n<p><img src=\"https://img-blog.csdnimg.cn/20200426083131906.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NycDk5NzU3NjI4MA==,size_16,color_FFFFFF,t_70#pic_center\" alt=\"https://img-blog.csdnimg.cn/20200426083131906.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NycDk5NzU3NjI4MA==,size_16,color_FFFFFF,t_70#pic_center\"></p>\n<p>设置camera 相机的名称（这个在控制器中会用到），同时设置相机的偏移量为（x=0,y=0.01,z=0.08），旋转偏移量（x=0,y=1.z=0,angle=3.14 rad）注意：相机的方向的正前方应该是 -z方向，也就是图中蓝色箭头的负方向，在添加相机的时候应当注意。</p>\n<p><img src=\"https://img-blog.csdnimg.cn/20200426084341516.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NycDk5NzU3NjI4MA==,size_16,color_FFFFFF,t_70#pic_center\" alt=\"https://img-blog.csdnimg.cn/20200426084341516.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NycDk5NzU3NjI4MA==,size_16,color_FFFFFF,t_70#pic_center\"></p>\n<p>在camera节点的属性栏中可以设置相机的宽、高和视场角等参数（详情可看官方文档提供的参数）</p>\n<p><img src=\"https://img-blog.csdnimg.cn/20200426085732331.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NycDk5NzU3NjI4MA==,size_16,color_FFFFFF,t_70#pic_center\" alt=\"https://img-blog.csdnimg.cn/20200426085732331.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NycDk5NzU3NjI4MA==,size_16,color_FFFFFF,t_70#pic_center\"></p>\n<p>注意：添加camera的过程中不设置boundingObject属性和 physics属性</p>\n<h1 id=\"2-添加camera控制接口代码\"><a href=\"#2-添加camera控制接口代码\" class=\"headerlink\" title=\"2.添加camera控制接口代码\"></a><strong>2.添加camera控制接口代码</strong></h1><p>看Cemera节点里命名</p>\n<p><img src=\"/post/Webots/Application/camera/%E6%B7%BB%E5%8A%A0%E6%91%84%E5%83%8F%E5%A4%B4/Untitled.png\" alt=\"Untitled.png\"></p>\n<p>根据节点里的命名，在控制器main函数里添加下面代码</p>\n<pre class=\"line-numbers language-c\" data-language=\"c\"><code class=\"language-c\">#include &lt;webots&#x2F;camera.h&gt;\n\nWbDeviceTag CAMERA;\nCAMERA &#x3D; wb_robot_get_device(&quot;camera1&quot;);     &#x2F;&#x2F;camera1 是自己定义的名字，在场景树中修改\nwb_camera_enable(CAMERA, TIME_STEP);</code></pre>\n\n<p>点击仿真就可以了</p>\n<h1 id=\"3-增加识别功能\"><a href=\"#3-增加识别功能\" class=\"headerlink\" title=\"3.增加识别功能\"></a><strong>3.增加识别功能</strong></h1><p>摄像头还有一种功能是识别物体功能，需要代码和配置摄像头 Recognition 来开启。</p>\n<pre class=\"line-numbers language-c\" data-language=\"c\"><code class=\"language-c\">#include &lt;webots&#x2F;camera_recognition_object.h&gt;\n\nWbDeviceTag CAMERA &#x3D; wb_robot_get_device(&quot;camera1&quot;);   &#x2F;&#x2F;camera1 是自己定义的名字，在场景树中修改\nwb_camera_enable(CAMERA, TIME_STEP);\nwb_camera_recognition_enable(CAMERA, TIME_STEP);\n\nint number_of_objects &#x3D; wb_camera_recognition_get_number_of_objects(CAMERA); &#x2F;&#x2F;获取识别对象的数量\nprintf(&quot;\\nRecognized %d objects.\\n&quot;, number_of_objects); \n\nconst WbCameraRecognitionObject *objects &#x3D; wb_camera_recognition_get_objects(CAMERA);    &#x2F;&#x2F;获取对象结构体\n\nfor (int i &#x3D; 0; i &lt; number_of_objects; ++i) &#123;\n  printf(&quot;Model of object %d: %s\\n&quot;, i, objects[i].model);      &#x2F;&#x2F;打印识别对象 Model 的名字\n  printf(&quot;Id of object %d: %d\\n&quot;, i, objects[i].id);            &#x2F;&#x2F;打印识别对象的 ID\n  printf(&quot;Relative position of object %d: %lf %lf %lf\\n&quot;, i, objects[i].position[0], objects[i].position[1],\n         objects[i].position[2]);\n  printf(&quot;Relative orientation of object %d: %lf %lf %lf %lf\\n&quot;, i, objects[i].orientation[0], objects[i].orientation[1],\n         objects[i].orientation[2], objects[i].orientation[3]);\n  printf(&quot;Size of object %d: %lf %lf\\n&quot;, i, objects[i].size[0], objects[i].size[1]);\n  printf(&quot;Position of the object %d on the camera image: %d %d\\n&quot;, i, objects[i].position_on_image[0],\n         objects[i].position_on_image[1]);                       &#x2F;&#x2F;打印识别对象在图像的坐标点\n  printf(&quot;Size of the object %d on the camera image: %d %d\\n&quot;, i, objects[i].size_on_image[0], objects[i].size_on_image[1]);\n  for (int j &#x3D; 0; j &lt; objects[i].number_of_colors; ++j)          \n    printf(&quot;- Color %d&#x2F;%d: %lf %lf %lf\\n&quot;, j + 1, objects[i].number_of_colors, objects[i].colors[3 * j],\n           objects[i].colors[3 * j + 1], objects[i].colors[3 * j + 2]);\n&#125;</code></pre>\n\n<p>其中 position_on_image 是我们需要的数据，因为从现象来看与 2020 视觉发来的数据是一致的，也就是相对于图像的坐标。</p>\n<p>代码写好后，还需要在之前摄像头的配置前提下，再配置 Recognition 节点。</p>\n<p>点开 Camera 节点，选到 recognition 节点，添加 Recognition，添加并修改一点参数。</p>\n<p><img src=\"/post/Webots/Application/camera/%E6%B7%BB%E5%8A%A0%E6%91%84%E5%83%8F%E5%A4%B4/Untitled%201.png\" alt=\"Untitled%201.png\"></p>\n<ul>\n<li>frameColor：定义识别框的颜色</li>\n<li>frameThickness：定义识别框的粗细</li>\n</ul>\n<p>摄像头还有一个抗锯齿功能，点击 Camera 中 antiAliasing 节点，默认是关闭的，打开就开启图像抗锯齿功能。</p>\n<p>假如觉得图像很模糊，可以调节图像 size，调得越大越清晰。</p>\n<h1 id=\"4-创建可被识别实体\"><a href=\"#4-创建可被识别实体\" class=\"headerlink\" title=\"4.创建可被识别实体\"></a><strong>4.创建可被识别实体</strong></h1><p>官方文档说 Camera 只能识别 Solid，我尝试了一下，发现普通的 Solid 是无法被识别的，我打开了官方自带的其中一个 Solid，对比后发现是要添加特定的参数才能被识别。</p>\n<h2 id=\"4-1-创建一个固体\"><a href=\"#4-1-创建一个固体\" class=\"headerlink\" title=\"4.1.创建一个固体\"></a>4.1.创建一个固体</h2><p><a href=\"https://lapzjfit.site/post/Webots%2FBasis%2FSimple%20model%2F%E7%AE%80%E5%8D%95%E6%A8%A1%E5%9E%8B%E4%BB%BF%E7%9C%9F\">简单模型仿真</a></p>\n<h2 id=\"4-2-定义名称\"><a href=\"#4-2-定义名称\" class=\"headerlink\" title=\"4.2.定义名称\"></a>4.2.定义名称</h2><p>从对象的结构体会返回被识别物体名称可以看出，被识别的物体是要有名字的，这名字是我们用户定义的，这里我随便定义了一个名字。</p>\n<p><img src=\"/post/Webots/Application/camera/%E6%B7%BB%E5%8A%A0%E6%91%84%E5%83%8F%E5%A4%B4/Untitled%202.png\" alt=\"Untitled%202.png\"></p>\n<h2 id=\"4-3-定义颜色\"><a href=\"#4-3-定义颜色\" class=\"headerlink\" title=\"4.3.定义颜色\"></a>4.3.定义颜色</h2><p>在 Camera 上，识别系统需要知道定义的固体的颜色，没有设置是不会被识别的，Soild 节点里有两个地方需要设置颜色，一个是给自己看的，一个是让 Camera 识别的，新建的时候并不会开启，需要手动开启。Solid→recognitionColors</p>\n<p><img src=\"/post/Webots/Application/camera/%E6%B7%BB%E5%8A%A0%E6%91%84%E5%83%8F%E5%A4%B4/Untitled%203.png\" alt=\"Untitled%203.png\"></p>\n<p>这里与自己用户设置的颜色不一样也没有关系，因为是给系统看的，当然了，一般也会与用户颜色调成一致。</p>\n<h1 id=\"5-尝试识别\"><a href=\"#5-尝试识别\" class=\"headerlink\" title=\"5.尝试识别\"></a><strong>5.尝试识别</strong></h1><p>把上诉都配置完成后，可以开始测试是否被识别到。效果如下图所示：</p>\n<p><img src=\"/post/Webots/Application/camera/%E6%B7%BB%E5%8A%A0%E6%91%84%E5%83%8F%E5%A4%B4/Untitled%204.png\" alt=\"Untitled%204.png\"></p>\n<p>控制台打印也正常：</p>\n<p><img src=\"/post/Webots/Application/camera/%E6%B7%BB%E5%8A%A0%E6%91%84%E5%83%8F%E5%A4%B4/Untitled%205.png\" alt=\"Untitled%205.png\"></p>\n<p>就证明成功了，把仿真暂停，鼠标移动到 Solid 上还能看见参数：</p>\n<p><img src=\"/post/Webots/Application/camera/%E6%B7%BB%E5%8A%A0%E6%91%84%E5%83%8F%E5%A4%B4/Untitled%206.png\" alt=\"Untitled%206.png\"></p>\n<p>识别在这里就结束了。</p>\n<h1 id=\"参考与致谢\"><a href=\"#参考与致谢\" class=\"headerlink\" title=\"参考与致谢\"></a><strong>参考与致谢</strong></h1><p><a href=\"https://cyberbotics.com/doc/reference/camera#camera\">Webots:摄像头</a></p>\n","text":"1.添加camera实体在Robot中添加 camera（camera相机） 设置这个 camera 相机的children中添加 transform 节点， 设置这个 transform 节点的children中添加shape节点，并设置外观和形状。设置半径 0.01 高度0....","link":"","photos":[],"count_time":{"symbolsCount":"3.3k","symbolsTime":"3 mins."},"categories":[{"name":"运动仿真","slug":"运动仿真","count":19,"path":"api/categories/运动仿真.json"}],"tags":[{"name":"Webots","slug":"Webots","count":19,"path":"api/tags/Webots.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#1-%E6%B7%BB%E5%8A%A0camera%E5%AE%9E%E4%BD%93\"><span class=\"toc-text\">1.添加camera实体</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#2-%E6%B7%BB%E5%8A%A0camera%E6%8E%A7%E5%88%B6%E6%8E%A5%E5%8F%A3%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">2.添加camera控制接口代码</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#3-%E5%A2%9E%E5%8A%A0%E8%AF%86%E5%88%AB%E5%8A%9F%E8%83%BD\"><span class=\"toc-text\">3.增加识别功能</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#4-%E5%88%9B%E5%BB%BA%E5%8F%AF%E8%A2%AB%E8%AF%86%E5%88%AB%E5%AE%9E%E4%BD%93\"><span class=\"toc-text\">4.创建可被识别实体</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4-1-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%9B%BA%E4%BD%93\"><span class=\"toc-text\">4.1.创建一个固体</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4-2-%E5%AE%9A%E4%B9%89%E5%90%8D%E7%A7%B0\"><span class=\"toc-text\">4.2.定义名称</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4-3-%E5%AE%9A%E4%B9%89%E9%A2%9C%E8%89%B2\"><span class=\"toc-text\">4.3.定义颜色</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#5-%E5%B0%9D%E8%AF%95%E8%AF%86%E5%88%AB\"><span class=\"toc-text\">5.尝试识别</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E4%B8%8E%E8%87%B4%E8%B0%A2\"><span class=\"toc-text\">参考与致谢</span></a></li></ol>","author":{"name":"Miraggio","slug":"blog-author","avatar":"https://s2.loli.net/2022/01/23/kntF9TEBOyHquwV.png","link":"https://lapzjfit.site","description":"喜欢研究奇奇怪怪的技术&游戏宅","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"建立 2021RC 图纸","uid":"dc9eb118380877df3be3b78227a1a198","slug":"Webots/Application/RC map/2021RC 图纸","date":"2022-01-30T12:49:36.000Z","updated":"2022-02-08T17:10:46.718Z","comments":true,"path":"api/articles/Webots/Application/RC map/2021RC 图纸.json","keywords":null,"cover":"https://s2.loli.net/2022/02/09/2sMCWbBZxHLzaJO.jpg","text":"1.Soliworks 导出图纸到 Webots2021RC 场地中间有三个可活动的壶，三个壶分别定义为三个关节，启动区，地板，线等分别单独作为一个Solid导出，总体导出为一个Robot节点。（后面会说为什么要这样导出） 2.建立场地地板其实小车也可以在原Robot节点上跑，但...","link":"","photos":[],"count_time":{"symbolsCount":"1k","symbolsTime":"1 mins."},"categories":[{"name":"运动仿真","slug":"运动仿真","count":19,"path":"api/categories/运动仿真.json"}],"tags":[{"name":"Webots","slug":"Webots","count":19,"path":"api/tags/Webots.json"}],"author":{"name":"Miraggio","slug":"blog-author","avatar":"https://s2.loli.net/2022/01/23/kntF9TEBOyHquwV.png","link":"https://lapzjfit.site","description":"喜欢研究奇奇怪怪的技术&游戏宅","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"激光测距","uid":"80ea0cc761d83c0a2eee1d3642703324","slug":"Webots/Application/laser/激光测距","date":"2022-01-30T12:49:36.000Z","updated":"2022-02-09T13:27:47.428Z","comments":true,"path":"api/articles/Webots/Application/laser/激光测距.json","keywords":null,"cover":"https://s2.loli.net/2022/02/09/RuOmPE9haZSG7Wy.jpg","text":"1.新建激光测距创建一个 DistanceSensor 节点，在 type 中修改为 lsaer，就是激光测距模式。 测距设置为一个高 0.004，半径 0.008 的圆柱，激光（测距）的方向是沿着 Z 轴（红色箭头）方向，于是我们要将传感器坐标旋转成这样 但是旋转成这样 chi...","link":"","photos":[],"count_time":{"symbolsCount":749,"symbolsTime":"1 mins."},"categories":[{"name":"运动仿真","slug":"运动仿真","count":19,"path":"api/categories/运动仿真.json"}],"tags":[{"name":"Webots","slug":"Webots","count":19,"path":"api/tags/Webots.json"}],"author":{"name":"Miraggio","slug":"blog-author","avatar":"https://s2.loli.net/2022/01/23/kntF9TEBOyHquwV.png","link":"https://lapzjfit.site","description":"喜欢研究奇奇怪怪的技术&游戏宅","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}