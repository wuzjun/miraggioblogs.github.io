{"title":"添加IMU传感器","uid":"1db430f3082768ced870d0c537dad34d","slug":"Webots/Application/IMU/添加IMU传感器","date":"2022-01-30T12:49:36.000Z","updated":"2022-02-08T17:03:35.875Z","comments":true,"path":"api/articles/Webots/Application/IMU/添加IMU传感器.json","keywords":null,"cover":"https://s2.loli.net/2022/02/09/NeDbjfVzIputR4G.jpg","content":"<h1 id=\"1-添加姿态测量传感器-InertialUnit\"><a href=\"#1-添加姿态测量传感器-InertialUnit\" class=\"headerlink\" title=\"1.添加姿态测量传感器 InertialUnit\"></a><strong>1.添加姿态测量传感器 InertialUnit</strong></h1><h2 id=\"1-1-创建一个姿态测量传感器\"><a href=\"#1-1-创建一个姿态测量传感器\" class=\"headerlink\" title=\"1.1.创建一个姿态测量传感器\"></a>1.1.创建一个姿态测量传感器</h2><p>在现有的 Robot 上才能创建。</p>\n<p>children→InertialUnit 可创建姿态传感器。在 InertialUnit 下创建一个形状，随便一个圆柱也行，放在小车的中心或者想放的任何位置。（跟上文创建摄像头操作基本相同）</p>\n<p>注意：添加 InertialUnit 的过程中不设置 boundingObject 属性和 physics 属性</p>\n<p><img src=\"/post/Webots/Application/IMU/%E6%B7%BB%E5%8A%A0IMU%E4%BC%A0%E6%84%9F%E5%99%A8/Untitled.png\" alt=\"Untitled.png\"></p>\n<h2 id=\"1-2-编写姿态测量传感器代码\"><a href=\"#1-2-编写姿态测量传感器代码\" class=\"headerlink\" title=\"1.2.编写姿态测量传感器代码\"></a>1.2.编写姿态测量传感器代码</h2><p>首先包含头文件，接着获取姿态传感器句柄，使能传感器。</p>\n<pre class=\"line-numbers language-c\" data-language=\"c\"><code class=\"language-c\">#include &lt;webots&#x2F;inertial_unit.h&gt;\n\n&#x2F;&#x2F; initialize IMU\n  WbDeviceTag IMU;\n  IMU &#x3D; wb_robot_get_device(&quot;imu&quot;);\n  wb_inertial_unit_enable(IMU, TIME_STEP);</code></pre>\n\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>根据官方的注释：</p>\n<p>该  wb_inertial_unit_get_roll_pitch_yaw 函数返回 InertialUnit 的当前侧倾角，俯仰角和偏航角。这些值作为3个组成部分的数组返回，因此只有索引 0、1 和 2 对访问返回的数组有效。请注意，索引 0、1 和 2 分别返回横滚角，俯仰角和偏航角。（注意：返回是弧度）</p></blockquote>\n<p>于是可以定义一个有 3 个元素的数组，用于接收 roll, pitch, yaw 的值。</p>\n<pre class=\"line-numbers language-c\" data-language=\"c\"><code class=\"language-c\">double Eular[3] &#x3D; &#123;0&#125;;\n&#x2F;&#x2F;把函数返回的值copy到自己定义的数组中\nmemcpy(Eular, wb_inertial_unit_get_roll_pitch_yaw(IMU), sizeof(double[3]));\n\nfor (int i &#x3D; 0; i &lt; 3; i++)&#123;\n      Eular[i] *&#x3D; 180.0 &#x2F; 3.14159;\n      Eular[i] +&#x3D; 180.0;            &#x2F;&#x2F;把接收回来的弧度转为角度，因为区间在[-π，π]之间\n    &#125;</code></pre>\n\n<p>通过 printf 可以在控制台实时看到角度的变化</p>\n<pre class=\"line-numbers language-c\" data-language=\"c\"><code class=\"language-c\">printf(&quot;roll &#x3D; %lf:\\n&quot;, Eular[0]);\nprintf(&quot;pitch &#x3D; %lf:\\n&quot;, Eular[1]);\nprintf(&quot;yaw &#x3D; %lf:\\n&quot;, Eular[2]);</code></pre>\n\n<h1 id=\"2-添加陀螺仪-Gyro\"><a href=\"#2-添加陀螺仪-Gyro\" class=\"headerlink\" title=\"2.添加陀螺仪 Gyro\"></a><strong>2.添加陀螺仪 Gyro</strong></h1><h2 id=\"2-1-创建一个陀螺仪\"><a href=\"#2-1-创建一个陀螺仪\" class=\"headerlink\" title=\"2.1.创建一个陀螺仪\"></a>2.1.创建一个陀螺仪</h2><p>与上文创建姿态测量传感器步骤一样（该 Robot 只要不设置 selfCollision ，允许穿模，可以与姿态传感器等重合）</p>\n<p><img src=\"/post/Webots/Application/IMU/%E6%B7%BB%E5%8A%A0IMU%E4%BC%A0%E6%84%9F%E5%99%A8/Untitled%201.png\" alt=\"Untitled%201.png\"></p>\n<h2 id=\"2-2-编写陀螺仪代码\"><a href=\"#2-2-编写陀螺仪代码\" class=\"headerlink\" title=\"2.2.编写陀螺仪代码\"></a>2.2.编写陀螺仪代码</h2><p>首先包含头文件，接着获取陀螺仪句柄，使能传感器。</p>\n<pre class=\"line-numbers language-c\" data-language=\"c\"><code class=\"language-c\">#include &lt;webots&#x2F;gyro.h&gt;\n\n&#x2F;&#x2F; initialize Gyro\n  WbDeviceTag GYRO;\n  GYRO &#x3D; wb_robot_get_device(&quot;gyro1&quot;);\n  wb_gyro_enable(GYRO, TIME_STEP);</code></pre>\n\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>根据官方的注释：</p>\n<p>该 wb_gyro_get_values 函数返回陀螺仪设备的当前测量值。这些值作为 3D 向量返回，因此只有索引 0、1 和 2 对访问向量有效。每个向量元素代表围绕陀螺节点的轴之一的角速度，以每秒弧度[rad / s] 表示。第一个元素对应于绕 x 轴的角速度，第二个元素对应于 y 轴等。（注意：根据车身的坐标，返回对应的角速度）</p></blockquote>\n<p>于是可以定义一个有 3 个元素的数组，用于接收 Vx, Vy, Vz的值。</p>\n<pre class=\"line-numbers language-c\" data-language=\"c\"><code class=\"language-c\">double Angular_velocity[3] &#x3D; &#123;0&#125;;\n&#x2F;&#x2F;把函数返回的值copy到自己定义的数组中\nmemcpy(Angular_velocity, wb_gyro_get_values(GYRO), sizeof(double[3]));\nprintf(&quot;Vx &#x3D; %lf:\\n&quot;, Angular_velocity[0]);\nprintf(&quot;Vy &#x3D; %lf:\\n&quot;, Angular_velocity[1]);\nprintf(&quot;Vz &#x3D; %lf:\\n&quot;, Angular_velocity[2]);</code></pre>\n\n<h1 id=\"3-添加加速度计-Accelerometer\"><a href=\"#3-添加加速度计-Accelerometer\" class=\"headerlink\" title=\"3.添加加速度计 Accelerometer\"></a><strong>3.添加加速度计 Accelerometer</strong></h1><h2 id=\"3-1-创建一个加速度度计\"><a href=\"#3-1-创建一个加速度度计\" class=\"headerlink\" title=\"3.1.创建一个加速度度计\"></a>3.1.创建一个加速度度计</h2><p>与上文创建姿态测量传感器步骤一样（该 Robot 只要不设置 selfCollision ，允许穿模，可以与姿态传感器等重合）</p>\n<p><img src=\"/post/Webots/Application/IMU/%E6%B7%BB%E5%8A%A0IMU%E4%BC%A0%E6%84%9F%E5%99%A8/Untitled%202.png\" alt=\"Untitled%202.png\"></p>\n<h2 id=\"3-2编写加速度计代码\"><a href=\"#3-2编写加速度计代码\" class=\"headerlink\" title=\"3.2编写加速度计代码\"></a>3.2编写加速度计代码</h2><p>首先包含头文件，接着获取加速度计句柄，使能传感器。</p>\n<pre class=\"line-numbers language-c\" data-language=\"c\"><code class=\"language-c\">#include &lt;webots&#x2F;accelerometer.h&gt;\n\n&#x2F;&#x2F; initialize Accelerometer\n  WbDeviceTag ACCELEROMETER;\n  ACCELEROMETER &#x3D; wb_robot_get_device(&quot;accelerometer1&quot;);\n  wb_accelerometer_enable(ACCELEROMETER, TIME_STEP);</code></pre>\n\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>根据官方的注释：</p>\n<p>该 wb_accelerometer_get_values 函数返回由加速度计测量的电流值。这些值作为3D向量返回，因此只有索引 0、1 和 2 对访问向量有效。向量的每个元素代表沿加速度计节点相应轴的加速度，以米/秒平方 [m /s²] 表示。第一个元素对应于 x 轴，第二个元素对应于 y 轴，依此类推。在重力作用下静止的加速度计沿垂直轴将指示 1 g（9.81 m /s²）。请注意，可以 gravity 在 WorldInfo 的字段中指定重力节点。为了获得仅由于运动引起的加速度，必须减去该偏移量。如果未减去失调，则器件在自由落体期间的输出将为零。</p></blockquote>\n<p>于是可以定义一个有 3 个元素的数组，用于接收 xAxis, yAxis, zAxis的值。</p>\n<pre class=\"line-numbers language-c\" data-language=\"c\"><code class=\"language-c\">double Acceleration[3] &#x3D; &#123;0&#125;;\n&#x2F;&#x2F;把函数返回的值copy到自己定义的数组中\nmemcpy(Acceleration, wb_accelerometer_get_values(ACCELEROMETER), sizeof(double[3]));\n&#x2F;*这里未减去偏移量，偏移量由实际仿真时测得*&#x2F;\nprintf(&quot;xAxis &#x3D; %lf:\\n&quot;, Acceleration[0]);\nprintf(&quot;yAxis &#x3D; %lf:\\n&quot;, Acceleration[1]);\nprintf(&quot;zAxis &#x3D; %lf:\\n&quot;, Acceleration[2]);</code></pre>\n\n<h1 id=\"4-添加磁力计-Compass\"><a href=\"#4-添加磁力计-Compass\" class=\"headerlink\" title=\"4.添加磁力计 Compass\"></a><strong>4.添加磁力计 Compass</strong></h1><h2 id=\"4-1-创建一个磁力计\"><a href=\"#4-1-创建一个磁力计\" class=\"headerlink\" title=\"4.1.创建一个磁力计\"></a>4.1.创建一个磁力计</h2><p>与上文创建姿态测量传感器步骤一样（该 Robot 只要不设置 selfCollision ，允许穿模，可以与姿态传感器等重合）</p>\n<p><img src=\"/post/Webots/Application/IMU/%E6%B7%BB%E5%8A%A0IMU%E4%BC%A0%E6%84%9F%E5%99%A8/Untitled%203.png\" alt=\"Untitled%203.png\"></p>\n<h2 id=\"4-2-编写磁力计代码\"><a href=\"#4-2-编写磁力计代码\" class=\"headerlink\" title=\"4.2.编写磁力计代码\"></a>4.2.编写磁力计代码</h2><p>首先包含头文件，接着获取磁力计句柄，使能传感器。</p>\n<pre class=\"line-numbers language-c\" data-language=\"c\"><code class=\"language-c\">#include &lt;webots&#x2F;compass.h&gt;\n\n&#x2F;&#x2F; initialize Compass\n  WbDeviceTag COMPASS;\n  COMPASS &#x3D; wb_robot_get_device(&quot;compass1&quot;);\n  wb_compass_enable(COMPASS, TIME_STEP);</code></pre>\n\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>根据官方的注释：</p>\n<p>该 wb_compass_get_values 函数返回当前的磁力计测量值。返回的向量指示北斗设备坐标系中的北向。这是 wb_compass_get_values 伪代码中函数的内部算法：</p></blockquote>\n<pre class=\"line-numbers language-c\" data-language=\"c\"><code class=\"language-c\">float[3] wb_compass_get_values() &#123;\n  float[3] n &#x3D; getGlobalNorthDirection();\n  n &#x3D; rotateToCompassOrientation3D(n);\n  n &#x3D; normalizeVector3D(n);\n  n[0] &#x3D; applyLookupTable(n[0]);\n  n[1] &#x3D; applyLookupTable(n[1]);\n  n[2] &#x3D; applyLookupTable(n[2]);\n  if (xAxis &#x3D;&#x3D; FALSE) n[0] &#x3D; 0.0;\n  if (yAxis &#x3D;&#x3D; FALSE) n[1] &#x3D; 0.0;\n  if (zAxis &#x3D;&#x3D; FALSE) n[2] &#x3D; 0.0;\n  return n;\n&#125;</code></pre>\n\n<p>如果 LookupTable 为空，并且三个 xAxis，yAxis 和 zAxis 字段均为 TRUE ，则返回向量的长度为 1.0 。</p>\n<p>这些值将作为 3D 向量返回，因此只有索引 0、1 和 2 对访问向量有效。让我们看一个例子。该 <code>WorldInfo.coordinateSystem</code> 字段的默认值是 <code>&quot;ENU&quot;</code> ，因此北方向与Y轴一致。现在，如果磁力计节点处于直立位置，这意味着其 z 轴与全局 z 轴对齐，则可以按以下方式计算以度为单位的方位角：</p>\n<pre class=\"line-numbers language-c\" data-language=\"c\"><code class=\"language-c\">double get_bearing_in_degrees() &#123;\n  const double *north &#x3D; wb_compass_get_values(tag);\n  double rad &#x3D; atan2(north[0], north[2]);\n  double bearing &#x3D; (rad - 1.5708) &#x2F; M_PI * 180.0;\n  if (bearing &lt; 0.0)\n    bearing &#x3D; bearing + 360.0;\n  return bearing;\n&#125;</code></pre>\n\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>其中<code>WorldInfo.coordinateSystem</code>的官方解释：</p>\n<p>该 coordinateSystem 字段指示全局坐标系的轴约定，定义了笛卡尔和重力方向。当前，它仅支持 “ ENU”（默认），“ NUE” 和 “ EUN”。“ ENU” 是指沿X轴的东方向，沿 Y 轴的北方向，以及沿 Z 轴的上方向。它是机器人（包括ROS）中使用最广泛的轴约定。“ NUE”是指沿 X 轴的北，沿 Y 轴的上，沿 Z 轴的东。这是从 VRML97 继承的旧版 Webots 轴约定。“ EUN” 是指沿X轴的东方向，沿 Y轴的轴向上，而沿 Z 轴的方向北。它类似于 “ NUE”，但北和东倒置。加速度计，指南针，InertialUnit 和 GPS 设备。</p></blockquote>\n<p><code>WorldInfo.coordinateSystem</code> 建世界时默认的是 ENU ，于是自己建小车的 Y 轴是向上的，所以北方向朝上。</p>\n<p><img src=\"/post/Webots/Application/IMU/%E6%B7%BB%E5%8A%A0IMU%E4%BC%A0%E6%84%9F%E5%99%A8/Untitled%204.png\" alt=\"Untitled%204.png\"></p>\n<pre><code>                                                                                                                                     其中：（绿色为Y轴）\n</code></pre>\n<p>套用官方的函数，定义angle；可以定义一个有 3 个元素的数组，用于接收 xAxis, yAxis, zAxis的值。</p>\n<pre class=\"line-numbers language-c\" data-language=\"c\"><code class=\"language-c\">double get_bearing_in_degrees(double* north)\n&#123;\n  double rad &#x3D; atan2(north[0], north[2]);\n  double bearing &#x3D; (rad - 1.5708) &#x2F; M_PI * 180.0;\n  if (bearing &lt; 0.0)\n    bearing &#x3D; bearing + 360.0;\n  return bearing;\n&#125;</code></pre>\n\n<pre class=\"line-numbers language-c\" data-language=\"c\"><code class=\"language-c\">double Magnetometer[3] &#x3D; &#123;0&#125;;\n&#x2F;&#x2F;把函数返回的值copy到自己定义的数组中\nmemcpy(Magnetometer, wb_compass_get_values(COMPASS), sizeof(double[3]));\n&#x2F;&#x2F;算出绕北方向旋转的角度\ndouble angle &#x3D; get_bearing_in_degrees(Magnetometer); \nprintf(&quot;angle &#x3D; %lf:\\n&quot;, angle);</code></pre>\n\n<h1 id=\"参考与致谢\"><a href=\"#参考与致谢\" class=\"headerlink\" title=\"参考与致谢\"></a><strong>参考与致谢</strong></h1><ul>\n<li><a href=\"https://cyberbotics.com/doc/reference/inertialunit\">Webots:姿态测量传感器</a></li>\n</ul>\n<ul>\n<li><a href=\"https://cyberbotics.com/doc/reference/gyro\">Webots:陀螺仪</a></li>\n</ul>\n<ul>\n<li><a href=\"https://cyberbotics.com/doc/reference/accelerometer\">Webots:加速度计</a></li>\n</ul>\n<ul>\n<li><a href=\"https://cyberbotics.com/doc/reference/compass\">Webots:磁力计</a></li>\n</ul>\n","text":"1.添加姿态测量传感器 InertialUnit1.1.创建一个姿态测量传感器在现有的 Robot 上才能创建。 children→InertialUnit 可创建姿态传感器。在 InertialUnit 下创建一个形状，随便一个圆柱也行，放在小车的中心或者想放的任何位置。（跟上...","link":"","photos":[],"count_time":{"symbolsCount":"5.7k","symbolsTime":"5 mins."},"categories":[{"name":"运动仿真","slug":"运动仿真","count":16,"path":"api/categories/运动仿真.json"}],"tags":[{"name":"Webots","slug":"Webots","count":16,"path":"api/tags/Webots.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#1-%E6%B7%BB%E5%8A%A0%E5%A7%BF%E6%80%81%E6%B5%8B%E9%87%8F%E4%BC%A0%E6%84%9F%E5%99%A8-InertialUnit\"><span class=\"toc-text\">1.添加姿态测量传感器 InertialUnit</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#1-1-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%A7%BF%E6%80%81%E6%B5%8B%E9%87%8F%E4%BC%A0%E6%84%9F%E5%99%A8\"><span class=\"toc-text\">1.1.创建一个姿态测量传感器</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#1-2-%E7%BC%96%E5%86%99%E5%A7%BF%E6%80%81%E6%B5%8B%E9%87%8F%E4%BC%A0%E6%84%9F%E5%99%A8%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">1.2.编写姿态测量传感器代码</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#2-%E6%B7%BB%E5%8A%A0%E9%99%80%E8%9E%BA%E4%BB%AA-Gyro\"><span class=\"toc-text\">2.添加陀螺仪 Gyro</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#2-1-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E9%99%80%E8%9E%BA%E4%BB%AA\"><span class=\"toc-text\">2.1.创建一个陀螺仪</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#2-2-%E7%BC%96%E5%86%99%E9%99%80%E8%9E%BA%E4%BB%AA%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">2.2.编写陀螺仪代码</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#3-%E6%B7%BB%E5%8A%A0%E5%8A%A0%E9%80%9F%E5%BA%A6%E8%AE%A1-Accelerometer\"><span class=\"toc-text\">3.添加加速度计 Accelerometer</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#3-1-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%8A%A0%E9%80%9F%E5%BA%A6%E5%BA%A6%E8%AE%A1\"><span class=\"toc-text\">3.1.创建一个加速度度计</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#3-2%E7%BC%96%E5%86%99%E5%8A%A0%E9%80%9F%E5%BA%A6%E8%AE%A1%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">3.2编写加速度计代码</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#4-%E6%B7%BB%E5%8A%A0%E7%A3%81%E5%8A%9B%E8%AE%A1-Compass\"><span class=\"toc-text\">4.添加磁力计 Compass</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4-1-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%A3%81%E5%8A%9B%E8%AE%A1\"><span class=\"toc-text\">4.1.创建一个磁力计</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#4-2-%E7%BC%96%E5%86%99%E7%A3%81%E5%8A%9B%E8%AE%A1%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">4.2.编写磁力计代码</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E4%B8%8E%E8%87%B4%E8%B0%A2\"><span class=\"toc-text\">参考与致谢</span></a></li></ol>","author":{"name":"Miraggio","slug":"blog-author","avatar":"https://s2.loli.net/2022/01/23/kntF9TEBOyHquwV.png","link":"https://lapzjfit.site","description":"喜欢研究奇奇怪怪的技术&游戏宅","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"补充篇","uid":"fb0e63c8a2cfbc52de8bd40f5b32b170","slug":"Webots/Basis/补充篇","date":"2022-01-30T12:49:36.000Z","updated":"2022-02-08T16:30:33.750Z","comments":true,"path":"api/articles/Webots/Basis/补充篇.json","keywords":null,"cover":"https://s2.loli.net/2022/02/08/hSPRD5aL8OeAZi1.jpg","text":"1.延时有时候做完一件事需要延时几毫秒，有些单片机里是用 Delay() 来表示，有些地方是用 Thread.Sleep() 表示，不管哪个函数，webots 里用哪个呢。 **wb_robot_step();** 在 webots 用这个函数，可以模拟控制器进行延时，而仿真的世...","link":"","photos":[],"count_time":{"symbolsCount":362,"symbolsTime":"1 mins."},"categories":[{"name":"运动仿真","slug":"运动仿真","count":16,"path":"api/categories/运动仿真.json"}],"tags":[{"name":"Webots","slug":"Webots","count":16,"path":"api/tags/Webots.json"}],"author":{"name":"Miraggio","slug":"blog-author","avatar":"https://s2.loli.net/2022/01/23/kntF9TEBOyHquwV.png","link":"https://lapzjfit.site","description":"喜欢研究奇奇怪怪的技术&游戏宅","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"建立 2021RC 图纸","uid":"dc9eb118380877df3be3b78227a1a198","slug":"Webots/Application/RC map/2021RC 图纸","date":"2022-01-30T12:49:36.000Z","updated":"2022-02-08T17:10:46.718Z","comments":true,"path":"api/articles/Webots/Application/RC map/2021RC 图纸.json","keywords":null,"cover":"https://s2.loli.net/2022/02/09/2sMCWbBZxHLzaJO.jpg","text":"1.Soliworks 导出图纸到 Webots2021RC 场地中间有三个可活动的壶，三个壶分别定义为三个关节，启动区，地板，线等分别单独作为一个Solid导出，总体导出为一个Robot节点。（后面会说为什么要这样导出） 2.建立场地地板其实小车也可以在原Robot节点上跑，但...","link":"","photos":[],"count_time":{"symbolsCount":"1k","symbolsTime":"1 mins."},"categories":[{"name":"运动仿真","slug":"运动仿真","count":16,"path":"api/categories/运动仿真.json"}],"tags":[{"name":"Webots","slug":"Webots","count":16,"path":"api/tags/Webots.json"}],"author":{"name":"Miraggio","slug":"blog-author","avatar":"https://s2.loli.net/2022/01/23/kntF9TEBOyHquwV.png","link":"https://lapzjfit.site","description":"喜欢研究奇奇怪怪的技术&游戏宅","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}