{"title":"PWR 电源管理系统","uid":"56bfdee5a1538a86dab7c1c2d98d1f03","slug":"cubeMX/cubeMX-PWR","date":"2022-01-27T10:49:36.000Z","updated":"2022-02-08T15:35:50.161Z","comments":true,"path":"api/articles/cubeMX/cubeMX-PWR.json","keywords":null,"cover":"https://s2.loli.net/2022/02/07/dWHnFjbumQfo7sY.jpg","content":"<h1 id=\"1-PVD-电源监控功能\"><a href=\"#1-PVD-电源监控功能\" class=\"headerlink\" title=\"1.PVD-电源监控功能\"></a><strong>1.PVD-电源监控功能</strong></h1><h2 id=\"1-1-初始化-PWR\"><a href=\"#1-1-初始化-PWR\" class=\"headerlink\" title=\"1.1.初始化 PWR\"></a>1.1.初始化 PWR</h2><pre class=\"line-numbers language-cpp\" data-language=\"cpp\"><code class=\"language-cpp\">PWR_PVDTypeDef pvd_config; &#x2F;&#x2F;定义句柄\n\nvoid PVD_Config(void) &#x2F;&#x2F;初始化\n&#123;\n    __HAL_RCC_PWR_CLK_ENABLE(); &#x2F;&#x2F;初始化时钟\n    pvd_config.PVDLevel &#x3D; PWR_PVDLEVEL_7;\n    pvd_config.Mode &#x3D; PWR_PVD_MODE_IT_RISING_FALLING;\n    HAL_PWR_ConfigPVD(&amp;pvd_config);\n    HAL_PWR_EnablePVD(); &#x2F;&#x2F;使能\n\n    HAL_NVIC_EnableIRQ(PVD_IRQn);         &#x2F;&#x2F;使能pvd中断通道\n    HAL_NVIC_SetPriority(PVD_IRQn, 0, 0); &#x2F;&#x2F;抢占优先级0，子优先级0\n&#125;</code></pre>\n\n<p>把 PVD_Config 在初始化任务中调用。</p>\n<h2 id=\"1-2-中断处理\"><a href=\"#1-2-中断处理\" class=\"headerlink\" title=\"1.2.中断处理\"></a>1.2.中断处理</h2><p>PWR-PVD 功能里官方自带一个处理函数：</p>\n<pre class=\"line-numbers language-cpp\" data-language=\"cpp\"><code class=\"language-cpp\">&#x2F;**\n  * @brief This function handles the PWR PVD interrupt request.\n  * @note This API should be called under the PVD_IRQHandler().\n  * @retval None\n  *&#x2F;\nvoid HAL_PWR_PVD_IRQHandler(void)\n&#123;\n  &#x2F;* Check PWR Exti flag *&#x2F;\n  if(__HAL_PWR_PVD_EXTI_GET_FLAG() !&#x3D; RESET)\n  &#123;\n    &#x2F;* PWR PVD interrupt user callback *&#x2F;\n    HAL_PWR_PVDCallback();\n    \n    &#x2F;* Clear PWR Exti pending bit *&#x2F;\n    __HAL_PWR_PVD_EXTI_CLEAR_FLAG();\n  &#125;\n&#125;</code></pre>\n\n<p>从该函数注释可以知道，这个函数要在 PVD_IRQHandler() 里调用，于是我们可以在中断中添加如下函数：</p>\n<pre class=\"line-numbers language-cpp\" data-language=\"cpp\"><code class=\"language-cpp\">&#x2F;**\n * @brief 电源监控\n * \n *&#x2F;\nvoid PVD_IRQHandler(void)\n&#123;\n  HAL_PWR_PVD_IRQHandler();\n&#125;</code></pre>\n\n<p>这样当板子的电压出现变化时，会进入这个中断，这时多半都是炸了，于是我们可以在这里添加软复位：</p>\n<pre class=\"line-numbers language-cpp\" data-language=\"cpp\"><code class=\"language-cpp\">void HAL_PWR_PVDCallback(void) &#x2F;&#x2F;中断回调函数\n&#123;\n    __set_FAULTMASK(1);\n    HAL_NVIC_SystemReset();\n&#125;</code></pre>\n\n<h1 id=\"参考与致谢\"><a href=\"#参考与致谢\" class=\"headerlink\" title=\"参考与致谢\"></a><strong>参考与致谢</strong></h1><ul>\n<li><a href=\"https://blog.csdn.net/weixin_42305847/article/details/108636322\">STM32 PWR电源管理系统</a></li>\n</ul>\n<ul>\n<li><a href=\"https://blog.csdn.net/qq_38326581/article/details/112728054\">PWR-电源管理系统概述</a></li>\n</ul>\n<ul>\n<li><a href=\"https://www.cxyzjd.com/article/qq_18707505/68922183\">PVD掉电数据存储</a></li>\n</ul>\n<ul>\n<li><a href=\"https://blog.csdn.net/weixin_39681058/article/details/112018976\">stm32如何执行软复位</a></li>\n</ul>\n<ul>\n<li><a href=\"https://www.icxbk.com/ask/detail/25873.html\">STM32H7如何用HAL库控制产生一个软件复位</a></li>\n</ul>\n","text":"1.PVD-电源监控功能1.1.初始化 PWRPWR_PVDTypeDef pvd_config; &#x2F;&#x2F;定义句柄 void PVD_Config(void) &#x2F;&#x2F;初始化 &#123; __HAL_RCC_PWR_CLK_ENABLE(); ...","link":"","photos":[],"count_time":{"symbolsCount":"1.5k","symbolsTime":"1 mins."},"categories":[{"name":"Embedded","slug":"Embedded","count":19,"path":"api/categories/Embedded.json"}],"tags":[{"name":"cubeMX","slug":"cubeMX","count":18,"path":"api/tags/cubeMX.json"},{"name":"PWR","slug":"PWR","count":1,"path":"api/tags/PWR.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#1-PVD-%E7%94%B5%E6%BA%90%E7%9B%91%E6%8E%A7%E5%8A%9F%E8%83%BD\"><span class=\"toc-text\">1.PVD-电源监控功能</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#1-1-%E5%88%9D%E5%A7%8B%E5%8C%96-PWR\"><span class=\"toc-text\">1.1.初始化 PWR</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#1-2-%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86\"><span class=\"toc-text\">1.2.中断处理</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%8F%82%E8%80%83%E4%B8%8E%E8%87%B4%E8%B0%A2\"><span class=\"toc-text\">参考与致谢</span></a></li></ol>","author":{"name":"Miraggio","slug":"blog-author","avatar":"https://s2.loli.net/2022/01/23/kntF9TEBOyHquwV.png","link":"https://lapzjfit.site","description":"喜欢研究奇奇怪怪的技术&游戏宅","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Freertos中队列的使用","uid":"d375d028bb2ac4562b320ed8e131081e","slug":"cubeMX/cubeMX-Freertos队列","date":"2022-01-27T10:49:36.000Z","updated":"2022-02-08T15:35:50.155Z","comments":true,"path":"api/articles/cubeMX/cubeMX-Freertos队列.json","keywords":null,"cover":"https://s2.loli.net/2022/01/27/B6WkKzXE13Stnqi.jpg","text":"1.队列基础学习可自行搜索。 2.队列的创建HAL库可以生成队列的，但是生成完之后不怎么方便使用，而且是有点BUG，于是我还是使用标准库的形式写。（创建队列必须放在HAL库规定的位置上，不然下次GENERATE时会删掉） 函数原型： xQueueHandle xQueueCrea...","link":"","photos":[],"count_time":{"symbolsCount":"3.2k","symbolsTime":"3 mins."},"categories":[{"name":"Embedded","slug":"Embedded","count":19,"path":"api/categories/Embedded.json"}],"tags":[{"name":"HAL","slug":"HAL","count":14,"path":"api/tags/HAL.json"},{"name":"cubeMX","slug":"cubeMX","count":18,"path":"api/tags/cubeMX.json"}],"author":{"name":"Miraggio","slug":"blog-author","avatar":"https://s2.loli.net/2022/01/23/kntF9TEBOyHquwV.png","link":"https://lapzjfit.site","description":"喜欢研究奇奇怪怪的技术&游戏宅","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"设置任务优先级思路，初始化顺序","uid":"fe0f1e831ccdde158001439cb8e6d513","slug":"FreeRTOS/Task/Task_Priority","date":"2022-01-27T10:49:36.000Z","updated":"2022-02-08T15:35:49.813Z","comments":true,"path":"api/articles/FreeRTOS/Task/Task_Priority.json","keywords":null,"cover":"https://s2.loli.net/2022/01/27/2MSkCZnBDz1oYJi.jpg","text":"在实际调车时，pid 参数的确定是一个很重要的一环，导致 pid 参数确定的难度除了自身调参水平，代码合理性，代码逻辑，数据刷新频率，还有优先级等问题。 如何初始化机器人也是代码稳定性一个很重要的一环，至少要保证机器人在你不希望动的时候不要动，该动的时候才开始启动。 现在只讲优先...","link":"","photos":[],"count_time":{"symbolsCount":"3.3k","symbolsTime":"3 mins."},"categories":[{"name":"Embedded","slug":"Embedded","count":19,"path":"api/categories/Embedded.json"}],"tags":[{"name":"HAL","slug":"HAL","count":14,"path":"api/tags/HAL.json"},{"name":"FreeRTOS","slug":"FreeRTOS","count":1,"path":"api/tags/FreeRTOS.json"}],"author":{"name":"Miraggio","slug":"blog-author","avatar":"https://s2.loli.net/2022/01/23/kntF9TEBOyHquwV.png","link":"https://lapzjfit.site","description":"喜欢研究奇奇怪怪的技术&游戏宅","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}